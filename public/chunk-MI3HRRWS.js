import{A as xe,B as me,C as Ge,D as at,E as dt,F as He,G as lt,H as ut,I as ct,J as ht,K as ft,L as pt,P as We,a as tt,b as it,c as kt,d as It,e as ve,f as se,g as nt,h as rt,i as ae,j as fe,k as pe,l as K,m as ot,n as st,o as O,p as ye,q as te,r as P,s as V,t as x,u as $,v as Re,w as de,x as le,y as Me,z as Ve}from"./chunk-FELZNX5I.js";var Ct=kt((oi,Ce)=>{"use strict";function S(i,e){if(!i)throw"First parameter is required.";e=e||{type:"video"},e=new mt(i,e);var t=this;function n(m){return e.disableLogs||console.log("RecordRTC version: ",t.version),m&&(e=new mt(i,m)),e.disableLogs||console.log("started recording "+e.type+" stream."),u?(u.clearRecordedData(),u.record(),g("recording"),t.recordingDuration&&h(),t):(s(function(){t.recordingDuration&&h()}),t)}function s(m){m&&(e.initCallback=function(){m(),m=e.initCallback=null});var c=new Ft(i,e);u=new c(i,e),u.record(),g("recording"),e.disableLogs||console.log("Initialized recorderType:",u.constructor.name,"for output-type:",e.type)}function o(m){if(m=m||function(){},!u){p();return}if(t.state==="paused"){t.resumeRecording(),setTimeout(function(){o(m)},1);return}t.state!=="recording"&&!e.disableLogs&&console.warn('Recording state should be: "recording", however current state is: ',t.state),e.disableLogs||console.log("Stopped recording "+e.type+" stream."),e.type!=="gif"?u.stop(c):(u.stop(),c()),g("stopped");function c(v){if(!u){typeof m.call=="function"?m.call(t,""):m("");return}Object.keys(u).forEach(function(b){typeof u[b]!="function"&&(t[b]=u[b])});var a=u.blob;if(!a)if(v)u.blob=a=v;else throw"Recording failed.";if(a&&!e.disableLogs&&console.log(a.type,"->",Je(a.size)),m){var d;try{d=F.createObjectURL(a)}catch{}typeof m.call=="function"?m.call(t,d):m(d)}e.autoWriteToDisk&&C(function(b){var w={};w[e.type+"Blob"]=b,Z.Store(w)})}}function l(){if(!u){p();return}if(t.state!=="recording"){e.disableLogs||console.warn("Unable to pause the recording. Recording state: ",t.state);return}g("paused"),u.pause(),e.disableLogs||console.log("Paused recording.")}function r(){if(!u){p();return}if(t.state!=="paused"){e.disableLogs||console.warn("Unable to resume the recording. Recording state: ",t.state);return}g("recording"),u.resume(),e.disableLogs||console.log("Resumed recording.")}function f(m){postMessage(new FileReaderSync().readAsDataURL(m))}function C(m,c){if(!m)throw"Pass a callback function over getDataURL.";var v=c?c.blob:(u||{}).blob;if(!v){e.disableLogs||console.warn("Blob encoder did not finish its job yet."),setTimeout(function(){C(m,c)},1e3);return}if(typeof Worker<"u"&&!navigator.mozGetUserMedia){var a=b(f);a.onmessage=function(w){m(w.data)},a.postMessage(v)}else{var d=new FileReader;d.readAsDataURL(v),d.onload=function(w){m(w.target.result)}}function b(w){try{var M=F.createObjectURL(new Blob([w.toString(),"this.onmessage =  function (eee) {"+w.name+"(eee.data);}"],{type:"application/javascript"})),R=new Worker(M);return F.revokeObjectURL(M),R}catch{}}}function h(m){if(m=m||0,t.state==="paused"){setTimeout(function(){h(m)},1e3);return}if(t.state!=="stopped"){if(m>=t.recordingDuration){o(t.onRecordingStopped);return}m+=1e3,setTimeout(function(){h(m)},1e3)}}function g(m){t&&(t.state=m,typeof t.onStateChanged.call=="function"?t.onStateChanged.call(t,m):t.onStateChanged(m))}var y='It seems that recorder is destroyed or "startRecording" is not invoked for '+e.type+" recorder.";function p(){e.disableLogs!==!0&&console.warn(y)}var u,_={startRecording:n,stopRecording:o,pauseRecording:l,resumeRecording:r,initRecorder:s,setRecordingDuration:function(m,c){if(typeof m>"u")throw"recordingDuration is required.";if(typeof m!="number")throw"recordingDuration must be a number.";return t.recordingDuration=m,t.onRecordingStopped=c||function(){},{onRecordingStopped:function(v){t.onRecordingStopped=v}}},clearRecordedData:function(){if(!u){p();return}u.clearRecordedData(),e.disableLogs||console.log("Cleared old recorded data.")},getBlob:function(){if(!u){p();return}return u.blob},getDataURL:C,toURL:function(){if(!u){p();return}return F.createObjectURL(u.blob)},getInternalRecorder:function(){return u},save:function(m){if(!u){p();return}vt(u.blob,m)},getFromDisk:function(m){if(!u){p();return}S.getFromDisk(e.type,m)},setAdvertisementArray:function(m){e.advertisement=[];for(var c=m.length,v=0;v<c;v++)e.advertisement.push({duration:v,image:m[v]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){t.state==="recording"&&!e.disableLogs&&console.warn("Stop an active recorder."),u&&typeof u.clearRecordedData=="function"&&u.clearRecordedData(),u=null,g("inactive"),t.blob=null},onStateChanged:function(m){e.disableLogs||console.log("Recorder state changed:",m)},state:"inactive",getState:function(){return t.state},destroy:function(){var m=e.disableLogs;e={disableLogs:!0},t.reset(),g("destroyed"),_=t=null,ge.AudioContextConstructor&&(ge.AudioContextConstructor.close(),ge.AudioContextConstructor=null),e.disableLogs=m,e.disableLogs||console.log("RecordRTC is destroyed.")},version:"5.6.2"};if(!this)return t=_,_;for(var D in _)this[D]=_[D];return t=this,_}S.version="5.6.2";typeof Ce<"u"&&(Ce.exports=S);typeof define=="function"&&define.amd&&define("RecordRTC",[],function(){return S});S.getFromDisk=function(i,e){if(!e)throw"callback is mandatory.";console.log("Getting recorded "+(i==="all"?"blobs":i+" blob ")+" from disk!"),Z.Fetch(function(t,n){i!=="all"&&n===i+"Blob"&&e&&e(t),i==="all"&&e&&e(t,n.replace("Blob",""))})};S.writeToDisk=function(i){console.log("Writing recorded blob(s) to disk!"),i=i||{},i.audio&&i.video&&i.gif?i.audio.getDataURL(function(e){i.video.getDataURL(function(t){i.gif.getDataURL(function(n){Z.Store({audioBlob:e,videoBlob:t,gifBlob:n})})})}):i.audio&&i.video?i.audio.getDataURL(function(e){i.video.getDataURL(function(t){Z.Store({audioBlob:e,videoBlob:t})})}):i.audio&&i.gif?i.audio.getDataURL(function(e){i.gif.getDataURL(function(t){Z.Store({audioBlob:e,gifBlob:t})})}):i.video&&i.gif?i.video.getDataURL(function(e){i.gif.getDataURL(function(t){Z.Store({videoBlob:e,gifBlob:t})})}):i.audio?i.audio.getDataURL(function(e){Z.Store({audioBlob:e})}):i.video?i.video.getDataURL(function(e){Z.Store({videoBlob:e})}):i.gif&&i.gif.getDataURL(function(e){Z.Store({gifBlob:e})})};function mt(i,e){return!e.recorderType&&!e.type&&(e.audio&&e.video?e.type="video":e.audio&&!e.video&&(e.type="audio")),e.recorderType&&!e.type&&(e.recorderType===Te||e.recorderType===ke||typeof we<"u"&&e.recorderType===we?e.type="video":e.recorderType===Ie?e.type="gif":e.recorderType===Fe?e.type="audio":e.recorderType===H&&(E(i,"audio").length&&E(i,"video").length||!E(i,"audio").length&&E(i,"video").length?e.type="video":E(i,"audio").length&&!E(i,"video").length&&(e.type="audio"))),typeof H<"u"&&typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&(e.mimeType||(e.mimeType="video/webm"),e.type||(e.type=e.mimeType.split("/")[0]),e.bitsPerSecond),e.type||(e.mimeType&&(e.type=e.mimeType.split("/")[0]),e.type||(e.type="audio")),e}function Ft(i,e){var t;return(ne||Ze||Ae)&&(t=Fe),typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&!ne&&(t=H),e.type==="video"&&(ne||Ae)&&(t=Te,typeof we<"u"&&typeof ReadableStream<"u"&&(t=we)),e.type==="gif"&&(t=Ie),e.type==="canvas"&&(t=ke),ce()&&t!==ke&&t!==Ie&&typeof MediaRecorder<"u"&&"requestData"in MediaRecorder.prototype&&(E(i,"video").length||E(i,"audio").length)&&(e.type==="audio"?typeof MediaRecorder.isTypeSupported=="function"&&MediaRecorder.isTypeSupported("audio/webm")&&(t=H):typeof MediaRecorder.isTypeSupported=="function"&&MediaRecorder.isTypeSupported("video/webm")&&(t=H)),i instanceof Array&&i.length&&(t=wt),e.recorderType&&(t=e.recorderType),!e.disableLogs&&t&&t.name&&console.log("Using recorderType:",t.name||t.constructor.name),!t&&Ee&&(t=H),t}function $e(i){this.addStream=function(e){e&&(i=e)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var e=this.mediaType,t,n=this.mimeType||{audio:null,video:null,gif:null};if(typeof e.audio!="function"&&ce()&&!E(i,"audio").length&&(e.audio=!1),typeof e.video!="function"&&ce()&&!E(i,"video").length&&(e.video=!1),typeof e.gif!="function"&&ce()&&!E(i,"video").length&&(e.gif=!1),!e.audio&&!e.video&&!e.gif)throw"MediaStream must have either audio or video tracks.";if(e.audio&&(t=null,typeof e.audio=="function"&&(t=e.audio),this.audioRecorder=new S(i,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:t,mimeType:n.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),e.video||this.audioRecorder.startRecording()),e.video){t=null,typeof e.video=="function"&&(t=e.video);var s=i;if(ce()&&e.audio&&typeof e.audio=="function"){var o=E(i,"video")[0];gt?(s=new J,s.addTrack(o),t&&t===Te&&(t=H)):(s=new J,s.addTrack(o))}this.videoRecorder=new S(s,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:t,mimeType:n.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp,workerPath:this.workerPath,webAssemblyPath:this.webAssemblyPath,frameRate:this.frameRate,bitrate:this.bitrate}),e.audio||this.videoRecorder.startRecording()}if(e.audio&&e.video){var l=this,r=ce()===!0;(e.audio instanceof Fe&&e.video||e.audio!==!0&&e.video!==!0&&e.audio!==e.video)&&(r=!1),r===!0?(l.audioRecorder=null,l.videoRecorder.startRecording()):l.videoRecorder.initRecorder(function(){l.audioRecorder.initRecorder(function(){l.videoRecorder.startRecording(),l.audioRecorder.startRecording()})})}e.gif&&(t=null,typeof e.gif=="function"&&(t=e.gif),this.gifRecorder=new S(i,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:t,mimeType:n.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(e){e=e||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(t){e(t,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(t){e(t,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(t){e(t,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(e){var t={};return this.audioRecorder&&(t.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(t.video=this.videoRecorder.getBlob()),this.gifRecorder&&(t.gif=this.gifRecorder.getBlob()),e&&e(t),t},this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=null),this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null),this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)},this.getDataURL=function(e){this.getBlob(function(s){s.audio&&s.video?t(s.audio,function(o){t(s.video,function(l){e({audio:o,video:l})})}):s.audio?t(s.audio,function(o){e({audio:o})}):s.video&&t(s.video,function(o){e({video:o})})});function t(s,o){if(typeof Worker<"u"){var l=n(function(C){postMessage(new FileReaderSync().readAsDataURL(C))});l.onmessage=function(f){o(f.data)},l.postMessage(s)}else{var r=new FileReader;r.readAsDataURL(s),r.onload=function(f){o(f.target.result)}}}function n(s){var o=F.createObjectURL(new Blob([s.toString(),"this.onmessage =  function (eee) {"+s.name+"(eee.data);}"],{type:"application/javascript"})),l=new Worker(o),r;if(typeof F<"u")r=F;else if(typeof webkitURL<"u")r=webkitURL;else throw"Neither URL nor webkitURL detected.";return r.revokeObjectURL(o),l}},this.writeToDisk=function(){S.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(e){e=e||{audio:!0,video:!0,gif:!0},e.audio&&this.audioRecorder&&this.audioRecorder.save(typeof e.audio=="string"?e.audio:""),e.video&&this.videoRecorder&&this.videoRecorder.save(typeof e.video=="string"?e.video:""),e.gif&&this.gifRecorder&&this.gifRecorder.save(typeof e.gif=="string"?e.gif:"")}}$e.getFromDisk=S.getFromDisk;$e.writeToDisk=S.writeToDisk;typeof S<"u"&&(S.MRecordRTC=$e);var Tt="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(function(i){i&&(typeof window<"u"||typeof global>"u"||(global.navigator={userAgent:Tt,getUserMedia:function(){}},global.console||(global.console={}),(typeof global.console.log>"u"||typeof global.console.error>"u")&&(global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),typeof document>"u"&&(i.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return e},i.HTMLVideoElement=function(){}),typeof location>"u"&&(i.location={protocol:"file:",href:"",hash:""}),typeof screen>"u"&&(i.screen={width:0,height:0}),typeof F>"u"&&(i.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),i.window=global))})(typeof global<"u"?global:null);var ie=window.requestAnimationFrame;typeof ie>"u"&&(typeof webkitRequestAnimationFrame<"u"?ie=webkitRequestAnimationFrame:typeof mozRequestAnimationFrame<"u"?ie=mozRequestAnimationFrame:typeof msRequestAnimationFrame<"u"?ie=msRequestAnimationFrame:typeof ie>"u"&&(ze=0,ie=function(i,e){var t=new Date().getTime(),n=Math.max(0,16-(t-ze)),s=setTimeout(function(){i(t+n)},n);return ze=t+n,s}));var ze,ue=window.cancelAnimationFrame;typeof ue>"u"&&(typeof webkitCancelAnimationFrame<"u"?ue=webkitCancelAnimationFrame:typeof mozCancelAnimationFrame<"u"?ue=mozCancelAnimationFrame:typeof msCancelAnimationFrame<"u"?ue=msCancelAnimationFrame:typeof ue>"u"&&(ue=function(i){clearTimeout(i)}));var be=window.AudioContext;typeof be>"u"&&(typeof webkitAudioContext<"u"&&(be=webkitAudioContext),typeof mozAudioContext<"u"&&(be=mozAudioContext));var F=window.URL;typeof F>"u"&&typeof webkitURL<"u"&&(F=webkitURL);typeof navigator<"u"&&typeof navigator.getUserMedia>"u"&&(typeof navigator.webkitGetUserMedia<"u"&&(navigator.getUserMedia=navigator.webkitGetUserMedia),typeof navigator.mozGetUserMedia<"u"&&(navigator.getUserMedia=navigator.mozGetUserMedia));var Ze=navigator.userAgent.indexOf("Edge")!==-1&&(!!navigator.msSaveBlob||!!navigator.msSaveOrOpenBlob),Ae=!!window.opera||navigator.userAgent.indexOf("OPR/")!==-1,gt=navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&"netscape"in window&&/ rv:/.test(navigator.userAgent),ne=!Ae&&!Ze&&!!navigator.webkitGetUserMedia||yt()||navigator.userAgent.toLowerCase().indexOf("chrome/")!==-1,Ee=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);Ee&&!ne&&navigator.userAgent.indexOf("CriOS")!==-1&&(Ee=!1,ne=!0);var J=window.MediaStream;typeof J>"u"&&typeof webkitMediaStream<"u"&&(J=webkitMediaStream);typeof J<"u"&&typeof J.prototype.stop>"u"&&(J.prototype.stop=function(){this.getTracks().forEach(function(i){i.stop()})});function Je(i){var e=1e3,t=["Bytes","KB","MB","GB","TB"];if(i===0)return"0 Bytes";var n=parseInt(Math.floor(Math.log(i)/Math.log(e)),10);return(i/Math.pow(e,n)).toPrecision(3)+" "+t[n]}function vt(i,e){if(!i)throw"Blob object is required.";if(!i.type)try{i.type="video/webm"}catch{}var t=(i.type||"video/webm").split("/")[1];if(t.indexOf(";")!==-1&&(t=t.split(";")[0]),e&&e.indexOf(".")!==-1){var n=e.split(".");e=n[0],t=n[1]}var s=(e||Math.round(Math.random()*9999999999)+888888888)+"."+t;if(typeof navigator.msSaveOrOpenBlob<"u")return navigator.msSaveOrOpenBlob(i,s);if(typeof navigator.msSaveBlob<"u")return navigator.msSaveBlob(i,s);var o=document.createElement("a");o.href=F.createObjectURL(i),o.download=s,o.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(o),typeof o.click=="function"?o.click():(o.target="_blank",o.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),F.revokeObjectURL(o.href)}function yt(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}function E(i,e){return!i||!i.getTracks?[]:i.getTracks().filter(function(t){return t.kind===(e||"audio")})}function bt(i,e){"srcObject"in e?e.srcObject=i:"mozSrcObject"in e?e.mozSrcObject=i:e.srcObject=i}function Ot(i,e){if(typeof EBML>"u")throw new Error("Please link: https://www.webrtc-experiment.com/EBML.js");var t=new EBML.Reader,n=new EBML.Decoder,s=EBML.tools,o=new FileReader;o.onload=function(l){var r=n.decode(this.result);r.forEach(function(g){t.read(g)}),t.stop();var f=s.makeMetadataSeekable(t.metadatas,t.duration,t.cues),C=this.result.slice(t.metadataSize),h=new Blob([f,C],{type:"video/webm"});e(h)},o.readAsArrayBuffer(i)}typeof S<"u"&&(S.invokeSaveAsDialog=vt,S.getTracks=E,S.getSeekableBlob=Ot,S.bytesToSize=Je,S.isElectron=yt);var ge={};typeof be<"u"?ge.AudioContext=be:typeof webkitAudioContext<"u"&&(ge.AudioContext=webkitAudioContext);typeof S<"u"&&(S.Storage=ge);function ce(){if(gt||Ee||Ze)return!0;var i=navigator.appVersion,e=navigator.userAgent,t=""+parseFloat(navigator.appVersion),n=parseInt(navigator.appVersion,10),s,o,l;return(ne||Ae)&&(o=e.indexOf("Chrome"),t=e.substring(o+7)),(l=t.indexOf(";"))!==-1&&(t=t.substring(0,l)),(l=t.indexOf(" "))!==-1&&(t=t.substring(0,l)),n=parseInt(""+t,10),isNaN(n)&&(t=""+parseFloat(navigator.appVersion),n=parseInt(navigator.appVersion,10)),n>=49}function H(i,e){var h=this;if(typeof i>"u")throw'First argument "MediaStream" is required.';if(typeof MediaRecorder>"u")throw"Your browser does not support the Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";if(e=e||{mimeType:"video/webm"},e.type==="audio"){if(E(i,"video").length&&E(i,"audio").length){var t;navigator.mozGetUserMedia?(t=new J,t.addTrack(E(i,"audio")[0])):t=new J(E(i,"audio")),i=t}(!e.mimeType||e.mimeType.toString().toLowerCase().indexOf("audio")===-1)&&(e.mimeType=ne?"audio/webm":"audio/ogg"),e.mimeType&&e.mimeType.toString().toLowerCase()!=="audio/ogg"&&navigator.mozGetUserMedia&&(e.mimeType="audio/ogg")}var n=[];this.getArrayOfBlobs=function(){return n},this.record=function(){h.blob=null,h.clearRecordedData(),h.timestamps=[],C=[],n=[];var g=e;e.disableLogs||console.log("Passing following config over MediaRecorder API.",g),r&&(r=null),ne&&!ce()&&(g="video/vp8"),typeof MediaRecorder.isTypeSupported=="function"&&g.mimeType&&(MediaRecorder.isTypeSupported(g.mimeType)||(e.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",g.mimeType),g.mimeType=e.type==="audio"?"audio/webm":"video/webm"));try{r=new MediaRecorder(i,g),e.mimeType=g.mimeType}catch{r=new MediaRecorder(i)}g.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in r&&r.canRecordMimeType(g.mimeType)===!1&&(e.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",g.mimeType)),r.ondataavailable=function(y){if(y.data&&C.push("ondataavailable: "+Je(y.data.size)),typeof e.timeSlice=="number"){if(y.data&&y.data.size&&(n.push(y.data),s(),typeof e.ondataavailable=="function")){var p=e.getNativeBlob?y.data:new Blob([y.data],{type:o(g)});e.ondataavailable(p)}return}if(!y.data||!y.data.size||y.data.size<100||h.blob){h.recordingCallback&&(h.recordingCallback(new Blob([],{type:o(g)})),h.recordingCallback=null);return}h.blob=e.getNativeBlob?y.data:new Blob([y.data],{type:o(g)}),h.recordingCallback&&(h.recordingCallback(h.blob),h.recordingCallback=null)},r.onstart=function(){C.push("started")},r.onpause=function(){C.push("paused")},r.onresume=function(){C.push("resumed")},r.onstop=function(){C.push("stopped")},r.onerror=function(y){y&&(y.name||(y.name="UnknownError"),C.push("error: "+y),e.disableLogs||(y.name.toString().toLowerCase().indexOf("invalidstate")!==-1?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",y):y.name.toString().toLowerCase().indexOf("notsupported")!==-1?console.error("MIME type (",g.mimeType,") is not supported.",y):y.name.toString().toLowerCase().indexOf("security")!==-1?console.error("MediaRecorder security error",y):y.name==="OutOfMemory"?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",y):y.name==="IllegalStreamModification"?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",y):y.name==="OtherRecordingError"?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",y):y.name==="GenericError"?console.error("The UA cannot provide the codec or recording option that has been requested.",y):console.error("MediaRecorder Error",y)),function(p){if(!h.manuallyStopped&&r&&r.state==="inactive"){delete e.timeslice,r.start(10*60*1e3);return}setTimeout(p,1e3)}(),r.state!=="inactive"&&r.state!=="stopped"&&r.stop())},typeof e.timeSlice=="number"?(s(),r.start(e.timeSlice)):r.start(36e5),e.initCallback&&e.initCallback()},this.timestamps=[];function s(){h.timestamps.push(new Date().getTime()),typeof e.onTimeStamp=="function"&&e.onTimeStamp(h.timestamps[h.timestamps.length-1],h.timestamps)}function o(g){return r&&r.mimeType?r.mimeType:g.mimeType||"video/webm"}this.stop=function(g){g=g||function(){},h.manuallyStopped=!0,r&&(this.recordingCallback=g,r.state==="recording"&&r.stop(),typeof e.timeSlice=="number"&&setTimeout(function(){h.blob=new Blob(n,{type:o(e)}),h.recordingCallback(h.blob)},100))},this.pause=function(){r&&r.state==="recording"&&r.pause()},this.resume=function(){r&&r.state==="paused"&&r.resume()},this.clearRecordedData=function(){r&&r.state==="recording"&&h.stop(l),l()};function l(){n=[],r=null,h.timestamps=[]}var r;this.getInternalRecorder=function(){return r};function f(){if("active"in i){if(!i.active)return!1}else if("ended"in i&&i.ended)return!1;return!0}this.blob=null,this.getState=function(){return r&&r.state||"inactive"};var C=[];this.getAllStates=function(){return C},typeof e.checkForInactiveTracks>"u"&&(e.checkForInactiveTracks=!1);var h=this;(function g(){if(!(!r||e.checkForInactiveTracks===!1)){if(f()===!1){e.disableLogs||console.log("MediaStream seems stopped."),h.stop();return}setTimeout(g,1e3)}})(),this.name="MediaStreamRecorder",this.toString=function(){return this.name}}typeof S<"u"&&(S.MediaStreamRecorder=H);function Fe(i,e){if(!E(i,"audio").length)throw"Your stream has no audio tracks.";e=e||{};var t=this,n=[],s=[],o=!1,l=0,r,f=2,C=e.desiredSampRate;e.leftChannel===!0&&(f=1),e.numberOfAudioChannels===1&&(f=1),(!f||f<1)&&(f=2),e.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: "+f),typeof e.checkForInactiveTracks>"u"&&(e.checkForInactiveTracks=!0);function h(){if(e.checkForInactiveTracks===!1)return!0;if("active"in i){if(!i.active)return!1}else if("ended"in i&&i.ended)return!1;return!0}this.record=function(){if(h()===!1)throw"Please make sure MediaStream is active.";v(),d=c=!1,o=!0,typeof e.timeSlice<"u"&&M()};function g(R,T){function A(k,he){var W=k.numberOfAudioChannels,B=k.leftBuffers.slice(0),ee=k.rightBuffers.slice(0),z=k.sampleRate,Q=k.internalInterleavedLength,N=k.desiredSampRate;W===2&&(B=Ue(B,Q),ee=Ue(ee,Q),N&&(B=re(B,N,z),ee=re(ee,N,z))),W===1&&(B=Ue(B,Q),N&&(B=re(B,N,z))),N&&(z=N);function re(I,q,j){var G=Math.round(I.length*(q/j)),U=[],Y=Number((I.length-1)/(G-1));U[0]=I[0];for(var oe=1;oe<G-1;oe++){var je=oe*Y,et=Number(Math.floor(je)).toFixed(),At=Number(Math.ceil(je)).toFixed(),Et=je-et;U[oe]=Pe(I[et],I[At],Et)}return U[G-1]=I[I.length-1],U}function Pe(I,q,j){return I+(q-I)*j}function Ue(I,q){for(var j=new Float64Array(q),G=0,U=I.length,Y=0;Y<U;Y++){var oe=I[Y];j.set(oe,G),G+=oe.length}return j}function Rt(I,q){for(var j=I.length+q.length,G=new Float64Array(j),U=0,Y=0;Y<j;)G[Y++]=I[U],G[Y++]=q[U],U++;return G}function _e(I,q,j){for(var G=j.length,U=0;U<G;U++)I.setUint8(q+U,j.charCodeAt(U))}var De;W===2&&(De=Rt(B,ee)),W===1&&(De=B);var Se=De.length,Mt=44+Se*2,Be=new ArrayBuffer(Mt),L=new DataView(Be);_e(L,0,"RIFF"),L.setUint32(4,36+Se*2,!0),_e(L,8,"WAVE"),_e(L,12,"fmt "),L.setUint32(16,16,!0),L.setUint16(20,1,!0),L.setUint16(22,W,!0),L.setUint32(24,z,!0),L.setUint32(28,z*W*2,!0),L.setUint16(32,W*2,!0),L.setUint16(34,16,!0),_e(L,36,"data"),L.setUint32(40,Se*2,!0);for(var Vt=Se,Xe=44,xt=1,Ne=0;Ne<Vt;Ne++)L.setInt16(Xe,De[Ne]*(32767*xt),!0),Xe+=2;if(he)return he({buffer:Be,view:L});postMessage({buffer:Be,view:L})}if(R.noWorker){A(R,function(k){T(k.buffer,k.view)});return}var X=y(A);X.onmessage=function(k){T(k.data.buffer,k.data.view),F.revokeObjectURL(X.workerURL),X.terminate()},X.postMessage(R)}function y(R){var T=F.createObjectURL(new Blob([R.toString(),";this.onmessage =  function (eee) {"+R.name+"(eee.data);}"],{type:"application/javascript"})),A=new Worker(T);return A.workerURL=T,A}this.stop=function(R){R=R||function(){},o=!1,g({desiredSampRate:C,sampleRate:m,numberOfAudioChannels:f,internalInterleavedLength:l,leftBuffers:n,rightBuffers:f===1?[]:s,noWorker:e.noWorker},function(T,A){t.blob=new Blob([A],{type:"audio/wav"}),t.buffer=new ArrayBuffer(A.buffer.byteLength),t.view=A,t.sampleRate=C||m,t.bufferSize=D,t.length=l,d=!1,R&&R(t.blob)})},typeof S.Storage>"u"&&(S.Storage={AudioContextConstructor:null,AudioContext:window.AudioContext||window.webkitAudioContext}),(!S.Storage.AudioContextConstructor||S.Storage.AudioContextConstructor.state==="closed")&&(S.Storage.AudioContextConstructor=new S.Storage.AudioContext);var p=S.Storage.AudioContextConstructor,u=p.createMediaStreamSource(i),_=[0,256,512,1024,2048,4096,8192,16384],D=typeof e.bufferSize>"u"?4096:e.bufferSize;if(_.indexOf(D)===-1&&(e.disableLogs||console.log("Legal values for buffer-size are "+JSON.stringify(_,null,"	"))),p.createJavaScriptNode)r=p.createJavaScriptNode(D,f,f);else if(p.createScriptProcessor)r=p.createScriptProcessor(D,f,f);else throw"WebAudio API has no support on this browser.";u.connect(r),e.bufferSize||(D=r.bufferSize);var m=typeof e.sampleRate<"u"?e.sampleRate:p.sampleRate||44100;(m<22050||m>96e3)&&(e.disableLogs||console.log("sample-rate must be under range 22050 and 96000.")),e.disableLogs||e.desiredSampRate&&console.log("Desired sample-rate: "+e.desiredSampRate);var c=!1;this.pause=function(){c=!0},this.resume=function(){if(h()===!1)throw"Please make sure MediaStream is active.";if(!o){e.disableLogs||console.log("Seems recording has been restarted."),this.record();return}c=!1},this.clearRecordedData=function(){e.checkForInactiveTracks=!1,o&&this.stop(a),a()};function v(){n=[],s=[],l=0,d=!1,o=!1,c=!1,p=null,t.leftchannel=n,t.rightchannel=s,t.numberOfAudioChannels=f,t.desiredSampRate=C,t.sampleRate=m,t.recordingLength=l,w={left:[],right:[],recordingLength:0}}function a(){r&&(r.onaudioprocess=null,r.disconnect(),r=null),u&&(u.disconnect(),u=null),v()}this.name="StereoAudioRecorder",this.toString=function(){return this.name};var d=!1;function b(R){if(!c){if(h()===!1&&(e.disableLogs||console.log("MediaStream seems stopped."),r.disconnect(),o=!1),!o){u&&(u.disconnect(),u=null);return}d||(d=!0,e.onAudioProcessStarted&&e.onAudioProcessStarted(),e.initCallback&&e.initCallback());var T=R.inputBuffer.getChannelData(0),A=new Float32Array(T);if(n.push(A),f===2){var X=R.inputBuffer.getChannelData(1),k=new Float32Array(X);s.push(k)}l+=D,t.recordingLength=l,typeof e.timeSlice<"u"&&(w.recordingLength+=D,w.left.push(A),f===2&&w.right.push(k))}}r.onaudioprocess=b,p.createMediaStreamDestination?r.connect(p.createMediaStreamDestination()):r.connect(p.destination),this.leftchannel=n,this.rightchannel=s,this.numberOfAudioChannels=f,this.desiredSampRate=C,this.sampleRate=m,t.recordingLength=l;var w={left:[],right:[],recordingLength:0};function M(){!o||typeof e.ondataavailable!="function"||typeof e.timeSlice>"u"||(w.left.length?(g({desiredSampRate:C,sampleRate:m,numberOfAudioChannels:f,internalInterleavedLength:w.recordingLength,leftBuffers:w.left,rightBuffers:f===1?[]:w.right},function(R,T){var A=new Blob([T],{type:"audio/wav"});e.ondataavailable(A),setTimeout(M,e.timeSlice)}),w={left:[],right:[],recordingLength:0}):setTimeout(M,e.timeSlice))}}typeof S<"u"&&(S.StereoAudioRecorder=Fe);function ke(i,e){if(typeof html2canvas>"u")throw"Please link: https://www.webrtc-experiment.com/screenshot.js";e=e||{},e.frameInterval||(e.frameInterval=10);var t=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(_){_ in document.createElement("canvas")&&(t=!0)});var n=(!!window.webkitRTCPeerConnection||!!window.webkitGetUserMedia)&&!!window.chrome,s=50,o=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);n&&o&&o[2]&&(s=parseInt(o[2],10)),n&&s<52&&(t=!1),e.useWhammyRecorder&&(t=!1);var l,r;if(t)if(e.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),i instanceof HTMLCanvasElement)l=i;else if(i instanceof CanvasRenderingContext2D)l=i.canvas;else throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";else navigator.mozGetUserMedia&&(e.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));var f;this.record=function(){if(f=!0,t&&!e.useWhammyRecorder){var _;"captureStream"in l?_=l.captureStream(25):"mozCaptureStream"in l?_=l.mozCaptureStream(25):"webkitCaptureStream"in l&&(_=l.webkitCaptureStream(25));try{var D=new J;D.addTrack(E(_,"video")[0]),_=D}catch{}if(!_)throw"captureStream API are NOT available.";r=new H(_,{mimeType:e.mimeType||"video/webm"}),r.record()}else u.frames=[],p=new Date().getTime(),y();e.initCallback&&e.initCallback()},this.getWebPImages=function(_){if(i.nodeName.toLowerCase()!=="canvas"){_();return}var D=u.frames.length;u.frames.forEach(function(m,c){var v=D-c;e.disableLogs||console.log(v+"/"+D+" frames remaining"),e.onEncodingCallback&&e.onEncodingCallback(v,D);var a=m.image.toDataURL("image/webp",1);u.frames[c].image=a}),e.disableLogs||console.log("Generating WebM"),_()},this.stop=function(_){f=!1;var D=this;if(t&&r){r.stop(_);return}this.getWebPImages(function(){u.compile(function(m){e.disableLogs||console.log("Recording finished!"),D.blob=m,D.blob.forEach&&(D.blob=new Blob([],{type:"video/webm"})),_&&_(D.blob),u.frames=[]})})};var C=!1;this.pause=function(){if(C=!0,r instanceof H){r.pause();return}},this.resume=function(){if(C=!1,r instanceof H){r.resume();return}f||this.record()},this.clearRecordedData=function(){f&&this.stop(h),h()};function h(){u.frames=[],f=!1,C=!1}this.name="CanvasRecorder",this.toString=function(){return this.name};function g(){var _=document.createElement("canvas"),D=_.getContext("2d");return _.width=i.width,_.height=i.height,D.drawImage(i,0,0),_}function y(){if(C)return p=new Date().getTime(),setTimeout(y,500);if(i.nodeName.toLowerCase()==="canvas"){var _=new Date().getTime()-p;p=new Date().getTime(),u.frames.push({image:g(),duration:_}),f&&setTimeout(y,e.frameInterval);return}html2canvas(i,{grabMouse:typeof e.showMousePointer>"u"||e.showMousePointer,onrendered:function(D){var m=new Date().getTime()-p;if(!m)return setTimeout(y,e.frameInterval);p=new Date().getTime(),u.frames.push({image:D.toDataURL("image/webp",1),duration:m}),f&&setTimeout(y,e.frameInterval)}})}var p=new Date().getTime(),u=new Qe.Video(100)}typeof S<"u"&&(S.CanvasRecorder=ke);function Te(i,e){e=e||{},e.frameInterval||(e.frameInterval=10),e.disableLogs||console.log("Using frames-interval:",e.frameInterval),this.record=function(){e.width||(e.width=320),e.height||(e.height=240),e.video||(e.video={width:e.width,height:e.height}),e.canvas||(e.canvas={width:e.width,height:e.height}),f.width=e.canvas.width||320,f.height=e.canvas.height||240,C=f.getContext("2d"),e.video&&e.video instanceof HTMLVideoElement?(h=e.video.cloneNode(),e.initCallback&&e.initCallback()):(h=document.createElement("video"),bt(i,h),h.onloadedmetadata=function(){e.initCallback&&e.initCallback()},h.width=e.video.width,h.height=e.video.height),h.muted=!0,h.play(),g=new Date().getTime(),y=new Qe.Video,e.disableLogs||(console.log("canvas resolutions",f.width,"*",f.height),console.log("video width/height",h.width||f.width,"*",h.height||f.height)),t(e.frameInterval)};function t(p){p=typeof p<"u"?p:10;var u=new Date().getTime()-g;if(!u)return setTimeout(t,p,p);if(l)return g=new Date().getTime(),setTimeout(t,100);g=new Date().getTime(),h.paused&&h.play(),C.drawImage(h,0,0,f.width,f.height),y.frames.push({duration:u,image:f.toDataURL("image/webp")}),o||setTimeout(t,p,p)}function n(p){var u=-1,_=p.length;(function D(){if(u++,u===_){p.callback();return}setTimeout(function(){p.functionToLoop(D,u)},1)})()}function s(p,u,_,D,m){var c=document.createElement("canvas");c.width=f.width,c.height=f.height;var v=c.getContext("2d"),a=[],d=u===-1,b=u&&u>0&&u<=p.length?u:p.length,w={r:0,g:0,b:0},M=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),R=_&&_>=0&&_<=1?_:0,T=D&&D>=0&&D<=1?D:0,A=!1;n({length:b,functionToLoop:function(X,k){var he,W,B,ee=function(){!A&&B-he<=B*T||(d&&(A=!0),a.push(p[k])),X()};if(A)ee();else{var z=new Image;z.onload=function(){v.drawImage(z,0,0,f.width,f.height);var Q=v.getImageData(0,0,f.width,f.height);he=0,W=Q.data.length,B=Q.data.length/4;for(var N=0;N<W;N+=4){var re={r:Q.data[N],g:Q.data[N+1],b:Q.data[N+2]},Pe=Math.sqrt(Math.pow(re.r-w.r,2)+Math.pow(re.g-w.g,2)+Math.pow(re.b-w.b,2));Pe<=M*R&&he++}ee()},z.src=p[k].image}},callback:function(){a=a.concat(p.slice(b)),a.length<=0&&a.push(p[p.length-1]),m(a)}})}var o=!1;this.stop=function(p){p=p||function(){},o=!0;var u=this;setTimeout(function(){s(y.frames,-1,null,null,function(_){y.frames=_,e.advertisement&&e.advertisement.length&&(y.frames=e.advertisement.concat(y.frames)),y.compile(function(D){u.blob=D,u.blob.forEach&&(u.blob=new Blob([],{type:"video/webm"})),p&&p(u.blob)})})},10)};var l=!1;this.pause=function(){l=!0},this.resume=function(){l=!1,o&&this.record()},this.clearRecordedData=function(){o||this.stop(r),r()};function r(){y.frames=[],o=!0,l=!1}this.name="WhammyRecorder",this.toString=function(){return this.name};var f=document.createElement("canvas"),C=f.getContext("2d"),h,g,y}typeof S<"u"&&(S.WhammyRecorder=Te);var Qe=function(){function i(n){this.frames=[],this.duration=n||1,this.quality=.8}i.prototype.add=function(n,s){if("canvas"in n&&(n=n.canvas),"toDataURL"in n&&(n=n.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/ig.test(n))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:n,duration:s||this.duration})};function e(n){var s=F.createObjectURL(new Blob([n.toString(),"this.onmessage =  function (eee) {"+n.name+"(eee.data);}"],{type:"application/javascript"})),o=new Worker(s);return F.revokeObjectURL(s),o}function t(n){function s(c){var v=l(c);if(!v)return[];for(var a=3e4,d=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:D(v.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:v.width,id:176},{data:v.height,id:186}]}]}]}]}],b=0,w=0;b<c.length;){var M=[],R=0;do M.push(c[b]),R+=c[b].duration,b++;while(b<c.length&&R<a);var T=0,A={id:524531317,data:o(w,T,M)};d[1].data.push(A),w+=R}return h(d)}function o(c,v,a){return[{data:c,id:231}].concat(a.map(function(d){var b=y({discardable:0,frame:d.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(v)});return v+=d.duration,{data:b,id:163}}))}function l(c){if(!c[0]){postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});return}for(var v=c[0].width,a=c[0].height,d=c[0].duration,b=1;b<c.length;b++)d+=c[b].duration;return{duration:d,width:v,height:a}}function r(c){for(var v=[];c>0;)v.push(c&255),c=c>>8;return new Uint8Array(v.reverse())}function f(c){return new Uint8Array(c.split("").map(function(v){return v.charCodeAt(0)}))}function C(c){var v=[],a=c.length%8?new Array(9-c.length%8).join("0"):"";c=a+c;for(var d=0;d<c.length;d+=8)v.push(parseInt(c.substr(d,8),2));return new Uint8Array(v)}function h(c){for(var v=[],a=0;a<c.length;a++){var d=c[a].data;typeof d=="object"&&(d=h(d)),typeof d=="number"&&(d=C(d.toString(2))),typeof d=="string"&&(d=f(d));var b=d.size||d.byteLength||d.length,w=Math.ceil(Math.ceil(Math.log(b)/Math.log(2))/8),M=b.toString(2),R=new Array(w*7+7+1-M.length).join("0")+M,T=new Array(w).join("0")+"1"+R;v.push(r(c[a].id)),v.push(C(T)),v.push(d)}return new Blob(v,{type:"video/webm"})}function g(c){var v="",a=c.length%8?new Array(9-c.length%8).join("0"):"";c=a+c;for(var d=0;d<c.length;d+=8)v+=String.fromCharCode(parseInt(c.substr(d,8),2));return v}function y(c){var v=0;if(c.keyframe&&(v|=128),c.invisible&&(v|=8),c.lacing&&(v|=c.lacing<<1),c.discardable&&(v|=1),c.trackNum>127)throw"TrackNumber > 127 not supported";var a=[c.trackNum|128,c.timecode>>8,c.timecode&255,v].map(function(d){return String.fromCharCode(d)}).join("")+c.frame;return a}function p(c){for(var v=c.RIFF[0].WEBP[0],a=v.indexOf("\x9D*"),d=0,b=[];d<4;d++)b[d]=v.charCodeAt(a+3+d);var w,M,R;return R=b[1]<<8|b[0],w=R&16383,R=b[3]<<8|b[2],M=R&16383,{width:w,height:M,data:v,riff:c}}function u(c,v){return parseInt(c.substr(v+4,4).split("").map(function(a){var d=a.charCodeAt(0).toString(2);return new Array(8-d.length+1).join("0")+d}).join(""),2)}function _(c){for(var v=0,a={};v<c.length;){var d=c.substr(v,4),b=u(c,v),w=c.substr(v+4+4,b);v+=8+b,a[d]=a[d]||[],d==="RIFF"||d==="LIST"?a[d].push(_(w)):a[d].push(w)}return a}function D(c){return[].slice.call(new Uint8Array(new Float64Array([c]).buffer),0).map(function(v){return String.fromCharCode(v)}).reverse().join("")}var m=new s(n.map(function(c){var v=p(_(atob(c.image.slice(23))));return v.duration=c.duration,v}));postMessage(m)}return i.prototype.compile=function(n){var s=e(t);s.onmessage=function(o){if(o.data.error){console.error(o.data.error);return}n(o.data)},s.postMessage(this.frames)},{Video:i}}();typeof S<"u"&&(S.Whammy=Qe);var Z={init:function(){var i=this;if(typeof indexedDB>"u"||typeof indexedDB.open>"u"){console.error("IndexedDB API are not available in this browser.");return}var e=1,t=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),n,s=indexedDB.open(t,e);function o(r){r.createObjectStore(i.dataStoreName)}function l(){var r=n.transaction([i.dataStoreName],"readwrite");i.videoBlob&&r.objectStore(i.dataStoreName).put(i.videoBlob,"videoBlob"),i.gifBlob&&r.objectStore(i.dataStoreName).put(i.gifBlob,"gifBlob"),i.audioBlob&&r.objectStore(i.dataStoreName).put(i.audioBlob,"audioBlob");function f(C){r.objectStore(i.dataStoreName).get(C).onsuccess=function(h){i.callback&&i.callback(h.target.result,C)}}f("audioBlob"),f("videoBlob"),f("gifBlob")}s.onerror=i.onError,s.onsuccess=function(){if(n=s.result,n.onerror=i.onError,n.setVersion)if(n.version!==e){var r=n.setVersion(e);r.onsuccess=function(){o(n),l()}}else l();else l()},s.onupgradeneeded=function(r){o(r.target.result)}},Fetch:function(i){return this.callback=i,this.init(),this},Store:function(i){return this.audioBlob=i.audioBlob,this.videoBlob=i.videoBlob,this.gifBlob=i.gifBlob,this.init(),this},onError:function(i){console.error(JSON.stringify(i,null,"	"))},dataStoreName:"recordRTC",dbName:null};typeof S<"u"&&(S.DiskStorage=Z);function Ie(i,e){if(typeof GIFEncoder>"u"){var t=document.createElement("script");t.src="https://www.webrtc-experiment.com/gif-recorder.js",(document.body||document.documentElement).appendChild(t)}e=e||{};var n=i instanceof CanvasRenderingContext2D||i instanceof HTMLCanvasElement;this.record=function(){if(typeof GIFEncoder>"u"){setTimeout(_.record,1e3);return}if(!f){setTimeout(_.record,1e3);return}n||(e.width||(e.width=C.offsetWidth||320),e.height||(e.height=C.offsetHeight||240),e.video||(e.video={width:e.width,height:e.height}),e.canvas||(e.canvas={width:e.width,height:e.height}),l.width=e.canvas.width||320,l.height=e.canvas.height||240,C.width=e.video.width||320,C.height=e.video.height||240),u=new GIFEncoder,u.setRepeat(0),u.setDelay(e.frameRate||200),u.setQuality(e.quality||10),u.start(),typeof e.onGifRecordingStarted=="function"&&e.onGifRecordingStarted(),g=Date.now();function D(m){if(_.clearedRecordedData!==!0){if(s)return setTimeout(function(){D(m)},100);h=ie(D),typeof p===void 0&&(p=m),!(m-p<90)&&(!n&&C.paused&&C.play(),n||r.drawImage(C,0,0,l.width,l.height),e.onGifPreview&&e.onGifPreview(l.toDataURL("image/png")),u.addFrame(r),p=m)}}h=ie(D),e.initCallback&&e.initCallback()},this.stop=function(D){D=D||function(){},h&&ue(h),y=Date.now(),this.blob=new Blob([new Uint8Array(u.stream().bin)],{type:"image/gif"}),D(this.blob),u.stream().bin=[]};var s=!1;this.pause=function(){s=!0},this.resume=function(){s=!1},this.clearRecordedData=function(){_.clearedRecordedData=!0,o()};function o(){u&&(u.stream().bin=[])}this.name="GifRecorder",this.toString=function(){return this.name};var l=document.createElement("canvas"),r=l.getContext("2d");n&&(i instanceof CanvasRenderingContext2D?(r=i,l=r.canvas):i instanceof HTMLCanvasElement&&(r=i.getContext("2d"),l=i));var f=!0;if(!n){var C=document.createElement("video");C.muted=!0,C.autoplay=!0,C.playsInline=!0,f=!1,C.onloadedmetadata=function(){f=!0},bt(i,C),C.play()}var h=null,g,y,p,u,_=this}typeof S<"u"&&(S.GifRecorder=Ie);function qe(i,e){var t="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(function(a){typeof S<"u"||a&&(typeof window<"u"||typeof global>"u"||(global.navigator={userAgent:t,getUserMedia:function(){}},global.console||(global.console={}),(typeof global.console.log>"u"||typeof global.console.error>"u")&&(global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),typeof document>"u"&&(a.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var d={getContext:function(){return d},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return d},a.HTMLVideoElement=function(){}),typeof location>"u"&&(a.location={protocol:"file:",href:"",hash:""}),typeof screen>"u"&&(a.screen={width:0,height:0}),typeof C>"u"&&(a.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),a.window=global))})(typeof global<"u"?global:null),e=e||"multi-streams-mixer";var n=[],s=!1,o=document.createElement("canvas"),l=o.getContext("2d");o.style.opacity=0,o.style.position="absolute",o.style.zIndex=-1,o.style.top="-1000em",o.style.left="-1000em",o.className=e,(document.body||document.documentElement).appendChild(o),this.disableLogs=!1,this.frameInterval=10,this.width=360,this.height=240,this.useGainNode=!0;var r=this,f=window.AudioContext;typeof f>"u"&&(typeof webkitAudioContext<"u"&&(f=webkitAudioContext),typeof mozAudioContext<"u"&&(f=mozAudioContext));var C=window.URL;typeof C>"u"&&typeof webkitURL<"u"&&(C=webkitURL),typeof navigator<"u"&&typeof navigator.getUserMedia>"u"&&(typeof navigator.webkitGetUserMedia<"u"&&(navigator.getUserMedia=navigator.webkitGetUserMedia),typeof navigator.mozGetUserMedia<"u"&&(navigator.getUserMedia=navigator.mozGetUserMedia));var h=window.MediaStream;typeof h>"u"&&typeof webkitMediaStream<"u"&&(h=webkitMediaStream),typeof h<"u"&&typeof h.prototype.stop>"u"&&(h.prototype.stop=function(){this.getTracks().forEach(function(a){a.stop()})});var g={};typeof f<"u"?g.AudioContext=f:typeof webkitAudioContext<"u"&&(g.AudioContext=webkitAudioContext);function y(a,d){"srcObject"in d?d.srcObject=a:"mozSrcObject"in d?d.mozSrcObject=a:d.srcObject=a}this.startDrawingFrames=function(){p()};function p(){if(!s){var a=n.length,d=!1,b=[];if(n.forEach(function(M){M.stream||(M.stream={}),M.stream.fullcanvas?d=M:b.push(M)}),d)o.width=d.stream.width,o.height=d.stream.height;else if(b.length){o.width=a>1?b[0].width*2:b[0].width;var w=1;(a===3||a===4)&&(w=2),(a===5||a===6)&&(w=3),(a===7||a===8)&&(w=4),(a===9||a===10)&&(w=5),o.height=b[0].height*w}else o.width=r.width||360,o.height=r.height||240;d&&d instanceof HTMLVideoElement&&u(d),b.forEach(function(M,R){u(M,R)}),setTimeout(p,r.frameInterval)}}function u(a,d){if(!s){var b=0,w=0,M=a.width,R=a.height;d===1&&(b=a.width),d===2&&(w=a.height),d===3&&(b=a.width,w=a.height),d===4&&(w=a.height*2),d===5&&(b=a.width,w=a.height*2),d===6&&(w=a.height*3),d===7&&(b=a.width,w=a.height*3),typeof a.stream.left<"u"&&(b=a.stream.left),typeof a.stream.top<"u"&&(w=a.stream.top),typeof a.stream.width<"u"&&(M=a.stream.width),typeof a.stream.height<"u"&&(R=a.stream.height),l.drawImage(a,b,w,M,R),typeof a.stream.onRender=="function"&&a.stream.onRender(l,b,w,M,R,d)}}function _(){s=!1;var a=D(),d=m();d&&d.getTracks().filter(function(w){return w.kind==="audio"}).forEach(function(w){a.addTrack(w)});var b;return i.forEach(function(w){w.fullcanvas&&(b=!0)}),a}function D(){v();var a;"captureStream"in o?a=o.captureStream():"mozCaptureStream"in o?a=o.mozCaptureStream():r.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");var d=new h;return a.getTracks().filter(function(b){return b.kind==="video"}).forEach(function(b){d.addTrack(b)}),o.stream=d,d}function m(){g.AudioContextConstructor||(g.AudioContextConstructor=new g.AudioContext),r.audioContext=g.AudioContextConstructor,r.audioSources=[],r.useGainNode===!0&&(r.gainNode=r.audioContext.createGain(),r.gainNode.connect(r.audioContext.destination),r.gainNode.gain.value=0);var a=0;if(i.forEach(function(d){if(d.getTracks().filter(function(w){return w.kind==="audio"}).length){a++;var b=r.audioContext.createMediaStreamSource(d);r.useGainNode===!0&&b.connect(r.gainNode),r.audioSources.push(b)}}),!!a)return r.audioDestination=r.audioContext.createMediaStreamDestination(),r.audioSources.forEach(function(d){d.connect(r.audioDestination)}),r.audioDestination.stream}function c(a){var d=document.createElement("video");return y(a,d),d.className=e,d.muted=!0,d.volume=0,d.width=a.width||r.width||360,d.height=a.height||r.height||240,d.play(),d}this.appendStreams=function(a){if(!a)throw"First parameter is required.";a instanceof Array||(a=[a]),a.forEach(function(d){var b=new h;if(d.getTracks().filter(function(R){return R.kind==="video"}).length){var w=c(d);w.stream=d,n.push(w),b.addTrack(d.getTracks().filter(function(R){return R.kind==="video"})[0])}if(d.getTracks().filter(function(R){return R.kind==="audio"}).length){var M=r.audioContext.createMediaStreamSource(d);r.audioDestination=r.audioContext.createMediaStreamDestination(),M.connect(r.audioDestination),b.addTrack(r.audioDestination.stream.getTracks().filter(function(R){return R.kind==="audio"})[0])}i.push(b)})},this.releaseStreams=function(){n=[],s=!0,r.gainNode&&(r.gainNode.disconnect(),r.gainNode=null),r.audioSources.length&&(r.audioSources.forEach(function(a){a.disconnect()}),r.audioSources=[]),r.audioDestination&&(r.audioDestination.disconnect(),r.audioDestination=null),r.audioContext&&r.audioContext.close(),r.audioContext=null,l.clearRect(0,0,o.width,o.height),o.stream&&(o.stream.stop(),o.stream=null)},this.resetVideoStreams=function(a){a&&!(a instanceof Array)&&(a=[a]),v(a)};function v(a){n=[],a=a||i,a.forEach(function(d){if(d.getTracks().filter(function(w){return w.kind==="video"}).length){var b=c(d);b.stream=d,n.push(b)}})}this.name="MultiStreamsMixer",this.toString=function(){return this.name},this.getMixedStream=_}typeof S>"u"&&(typeof Ce<"u"&&(Ce.exports=qe),typeof define=="function"&&define.amd&&define("MultiStreamsMixer",[],function(){return qe}));function wt(i,e){i=i||[];var t=this,n,s;e=e||{elementClass:"multi-streams-mixer",mimeType:"video/webm",video:{width:360,height:240}},e.frameInterval||(e.frameInterval=10),e.video||(e.video={}),e.video.width||(e.video.width=360),e.video.height||(e.video.height=240),this.record=function(){n=new qe(i,e.elementClass||"multi-streams-mixer"),o().length&&(n.frameInterval=e.frameInterval||10,n.width=e.video.width||360,n.height=e.video.height||240,n.startDrawingFrames()),e.previewStream&&typeof e.previewStream=="function"&&e.previewStream(n.getMixedStream()),s=new H(n.getMixedStream(),e),s.record()};function o(){var l=[];return i.forEach(function(r){E(r,"video").forEach(function(f){l.push(f)})}),l}this.stop=function(l){s&&s.stop(function(r){t.blob=r,l(r),t.clearRecordedData()})},this.pause=function(){s&&s.pause()},this.resume=function(){s&&s.resume()},this.clearRecordedData=function(){s&&(s.clearRecordedData(),s=null),n&&(n.releaseStreams(),n=null)},this.addStreams=function(l){if(!l)throw"First parameter is required.";l instanceof Array||(l=[l]),i.concat(l),!(!s||!n)&&(n.appendStreams(l),e.previewStream&&typeof e.previewStream=="function"&&e.previewStream(n.getMixedStream()))},this.resetVideoStreams=function(l){n&&(l&&!(l instanceof Array)&&(l=[l]),n.resetVideoStreams(l))},this.getMixer=function(){return n},this.name="MultiStreamRecorder",this.toString=function(){return this.name}}typeof S<"u"&&(S.MultiStreamRecorder=wt);function Lt(i,e){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if(typeof i>"u")throw'First argument "MediaStream" is required.';var t=this;t.recordRTC=new S(i,e),this.startRecording=function(){return new Promise(function(n,s){try{t.recordRTC.startRecording(),n()}catch(o){s(o)}})},this.stopRecording=function(){return new Promise(function(n,s){try{t.recordRTC.stopRecording(function(o){if(t.blob=t.recordRTC.getBlob(),!t.blob||!t.blob.size){s("Empty blob.",t.blob);return}n(o)})}catch(o){s(o)}})},this.pauseRecording=function(){return new Promise(function(n,s){try{t.recordRTC.pauseRecording(),n()}catch(o){s(o)}})},this.resumeRecording=function(){return new Promise(function(n,s){try{t.recordRTC.resumeRecording(),n()}catch(o){s(o)}})},this.getDataURL=function(n){return new Promise(function(s,o){try{t.recordRTC.getDataURL(function(l){s(l)})}catch(l){o(l)}})},this.getBlob=function(){return new Promise(function(n,s){try{n(t.recordRTC.getBlob())}catch(o){s(o)}})},this.getInternalRecorder=function(){return new Promise(function(n,s){try{n(t.recordRTC.getInternalRecorder())}catch(o){s(o)}})},this.reset=function(){return new Promise(function(n,s){try{n(t.recordRTC.reset())}catch(o){s(o)}})},this.destroy=function(){return new Promise(function(n,s){try{n(t.recordRTC.destroy())}catch(o){s(o)}})},this.getState=function(){return new Promise(function(n,s){try{n(t.recordRTC.getState())}catch(o){s(o)}})},this.blob=null,this.version="5.6.2"}typeof S<"u"&&(S.RecordRTCPromisesHandler=Lt);function we(i,e){(typeof ReadableStream>"u"||typeof WritableStream>"u")&&console.error("Following polyfill is strongly recommended: https://unpkg.com/@mattiasbuelens/web-streams-polyfill/dist/polyfill.min.js"),e=e||{},e.width=e.width||640,e.height=e.height||480,e.frameRate=e.frameRate||30,e.bitrate=e.bitrate||1200,e.realtime=e.realtime||!0;function t(h,g){return F.createObjectURL(new Blob([h],{type:g||""}))}var n;function s(){return new ReadableStream({start:function(h){var g=document.createElement("canvas"),y=document.createElement("video"),p=!0;y.srcObject=i,y.muted=!0,y.height=e.height,y.width=e.width,y.volume=0,y.onplaying=function(){g.width=e.width,g.height=e.height;var u=g.getContext("2d"),_=1e3/e.frameRate,D=setInterval(function(){if(n&&(clearInterval(D),h.close()),p&&(p=!1,e.onVideoProcessStarted&&e.onVideoProcessStarted()),u.drawImage(y,0,0),h._controlledReadableStream.state!=="closed")try{h.enqueue(u.getImageData(0,0,e.width,e.height))}catch{}},_)},y.play()}})}var o;function l(h,g){if(!e.workerPath&&!g){n=!1,fetch("https://unpkg.com/webm-wasm@latest/dist/webm-worker.js").then(function(p){p.arrayBuffer().then(function(u){l(h,u)})});return}if(!e.workerPath&&g instanceof ArrayBuffer){var y=new Blob([g],{type:"text/javascript"});e.workerPath=F.createObjectURL(y)}e.workerPath||console.error("workerPath parameter is missing."),o=new Worker(e.workerPath),o.postMessage(e.webAssemblyPath||"https://unpkg.com/webm-wasm@latest/dist/webm-wasm.wasm"),o.addEventListener("message",function(p){p.data==="READY"?(o.postMessage({width:e.width,height:e.height,bitrate:e.bitrate||1200,timebaseDen:e.frameRate||30,realtime:e.realtime}),s().pipeTo(new WritableStream({write:function(u){if(n){console.error("Got image, but recorder is finished!");return}o.postMessage(u.data.buffer,[u.data.buffer])}}))):p.data&&(r||C.push(p.data))})}this.record=function(){C=[],r=!1,this.blob=null,l(i),typeof e.initCallback=="function"&&e.initCallback()};var r;this.pause=function(){r=!0},this.resume=function(){r=!1};function f(h){if(!o){h&&h();return}o.addEventListener("message",function(g){g.data===null&&(o.terminate(),o=null,h&&h())}),o.postMessage(null)}var C=[];this.stop=function(h){n=!0;var g=this;f(function(){g.blob=new Blob(C,{type:"video/webm"}),h(g.blob)})},this.name="WebAssemblyRecorder",this.toString=function(){return this.name},this.clearRecordedData=function(){C=[],r=!1,this.blob=null},this.blob=null}typeof S<"u"&&(S.WebAssemblyRecorder=we)});var Ye=It(Ct());var Pt=["audioProgress"],Ut=["videoContainer"],Bt=["transcriptsContainer"],Nt=i=>({display:i}),jt=(i,e)=>({"btn-connection":i,"btn-close":e});function Gt(i,e){if(i&1&&(V(0,"div")(1,"h6",14),me(2),x(),V(3,"p"),me(4),x()()),i&2){let t=e.$implicit;O(2),Ge(" ",t.name," "),O(2),Ge(" ",t.text," ")}}function Ht(i,e){i&1&&(V(0,"div",15)(1,"h1",16),me(2," PEER "),x(),V(3,"p",17),me(4," Comunicacion a tiempo real "),x()())}function Wt(i,e){i&1&&(V(0,"h2",25),me(1," Conectado "),x())}function zt(i,e){i&1&&(K(),V(0,"svg",26),$(1,"path",27),x())}function qt(i,e){if(i&1){let t=Re();V(0,"div",18)(1,"div",19)(2,"div",20)(3,"div",21)(4,"div",22),de("click",function(){fe(t);let s=le();return pe(s.joinRoom())}),te(5,Wt,2,0,"h2",23),V(6,"div"),te(7,zt,2,0,"svg",24),x()()()()()()}if(i&2){let t=le();O(4),P("ngClass",dt(3,jt,!t.connection,t.connection)),O(),P("ngIf",t.connection),O(2),P("ngIf",!t.connection)}}function $t(i,e){i&1&&(V(0,"div",28),$(1,"div",29,1),x())}function Zt(i,e){i&1&&(K(),V(0,"svg",37),$(1,"path",38),x())}function Jt(i,e){i&1&&(K(),V(0,"svg",39),$(1,"path",40),x())}function Qt(i,e){i&1&&(K(),V(0,"svg",37),$(1,"path",41)(2,"path",42),x())}function Yt(i,e){i&1&&(K(),V(0,"svg",37),$(1,"path",43),x())}function Kt(i,e){i&1&&(K(),V(0,"svg",44),$(1,"path",45)(2,"path",46)(3,"path",47),x())}function Xt(i,e){i&1&&(K(),V(0,"svg",37),$(1,"path",48),x())}function ei(i,e){if(i&1){let t=Re();V(0,"div",30)(1,"div",31)(2,"div",32),de("click",function(){fe(t);let s=le();return pe(s.toggleVideo(!s.videoStatus))}),V(3,"div",33),te(4,Zt,2,0,"svg",34)(5,Jt,2,0,"svg",35),x()(),V(6,"div",32),de("click",function(){fe(t);let s=le();return pe(s.toggleMic(!s.micStatus))}),V(7,"div",33),te(8,Qt,3,0,"svg",34)(9,Yt,2,0,"svg",34),x()(),V(10,"div",32),de("click",function(){fe(t);let s=le();return pe(s.toggleSpeakerStatus(!s.speakerStatus))}),te(11,Kt,4,0,"svg",36)(12,Xt,2,0,"svg",34),x()()()}if(i&2){let t=le();O(4),P("ngIf",t.videoStatus),O(),P("ngIf",!t.videoStatus),O(3),P("ngIf",t.micStatus),O(),P("ngIf",!t.micStatus),O(2),P("ngIf",t.speakerStatus),O(),P("ngIf",!t.speakerStatus)}}var Oe=class i{constructor(e,t,n){this.cdr=e;this.ngZone=t;this.location=n}micStatus=!0;videoStatus=!0;speakerStatus=!0;connection=!1;urlWS="wss://192.168.1.120:3000/ws";audioProgress;videoContainer;audioProgressBars=new Map;localStream;remoteStream;isRoomCreator=!1;rtcPeerConnection;showRoomSelection=!0;videoChatContainer=!1;mediaConstraints={video:{width:{ideal:640},height:{ideal:360},frameRate:{ideal:30,max:30}},audio:{sampleSize:8,channelCount:2,echoCancellation:!0,noiseSuppression:!0}};listUUIDS=[];iceServers={iceServers:[{urls:"stun:stun.l.google.com:19302"}]};ws;roomId="123";audioContext=null;analyser=null;dataArray=null;remoteVideos=[];recognition=null;isListening=!1;transcript="";transcriptTexts=[];openModelTranscript=!1;recorder=null;stream=null;recording=!1;transcriptsContainer;ngAfterViewInit(){}scrollToBottom(){try{this.transcriptsContainer.nativeElement.scrollTop=this.transcriptsContainer.nativeElement.scrollHeight}catch(e){console.log(e)}}initializeSpeechRecognition(){this.recognition=null,this.recognition=new(window.SpeechRecognition||window.webkitSpeechRecognition),this.recognition.lang="es-MX",this.recognition.onstart=()=>{this.isListening=!0},this.recognition.onresult=e=>{this.ngZone.run(()=>{for(let t=0;t<e.results.length;t++){let n=e.results[t][0].transcript;this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"transcript_text",roomId:this.roomId,text:n})),this.transcriptTexts.push({name:"Tu",text:n}),console.log(n),console.log(this.transcriptTexts),this.scrollToBottom()}})},this.recognition.onend=()=>{this.isListening=!1,this.recognition.start()},this.recognition.start()}joinRoom(){if(!this.connection&&this.roomId.trim()!=="")try{this.ws.send(JSON.stringify({type:"join",roomId:this.roomId})),this.toggleDevices(!0),this.showVideoConference(),this.connection=!0}catch{this.connectWebsocket(),this.joinRoom()}else this.toggleDevices(!1),this.connection=!1,this.hiddenVideoConference(),this.videoContainer.nativeElement.querySelectorAll("div").forEach(n=>{n.remove()}),this.ws.send(JSON.stringify({type:"close_call",roomId:this.roomId}))}toggleMic(e){this.micStatus=e,this.localStream&&this.localStream.getAudioTracks().forEach(t=>{t.enabled=this.micStatus})}toggleVideo(e){this.videoStatus=e,this.localStream&&(console.log("localStream: ",this.localStream.getVideoTracks()),this.localStream.getVideoTracks().forEach(t=>{t.enabled=this.videoStatus}))}toggleSpeakerStatus(e){this.speakerStatus=e,this.remoteStream&&this.remoteStream.getAudioTracks().forEach(t=>{t.enabled=this.speakerStatus})}ngOnInit(){let e=window.location.hostname,t=window.location.port,n=window.location.protocol;this.urlWS=`${n}//${e}:${t}/ws`,console.log("URL WS:",this.urlWS),this.connectWebsocket()}toggleDevices(e){e||(this.localStream.getVideoTracks().forEach(t=>{t.stop()}),this.localStream.getAudioTracks().forEach(t=>{t.stop()})),this.toggleMic(e),this.toggleSpeakerStatus(e),this.toggleVideo(e)}connectWebsocket(){this.ws=new WebSocket(this.urlWS),this.ws.onopen=()=>{console.log("Connected to WebSocket server")},this.ws.onmessage=e=>ve(this,null,function*(){let t=JSON.parse(e.data);switch(t.type){case"room_created":yield this.setLocalStream(this.mediaConstraints),this.isRoomCreator=!0;break;case"room_joined":yield this.setLocalStream(this.mediaConstraints),this.sendStartCall(this.roomId);break;case"transcript_text":this.transcriptTexts.push({name:"Invitado",text:t.message});break;case"start_call":this.createPeerConnection(t),yield this.createOffer();break;case"webrtc_offer":this.createPeerConnection(t),this.rtcPeerConnection.setRemoteDescription(new RTCSessionDescription(t.sdp)),yield this.createAnswer();break;case"webrtc_answer":this.rtcPeerConnection.setRemoteDescription(new RTCSessionDescription(t.sdp));break;case"webrtc_ice_candidate":let n=new RTCIceCandidate({sdpMLineIndex:t.label,candidate:t.candidate});this.rtcPeerConnection.addIceCandidate(n);break;case"close_call":this.removeVideoById(t.uuid);break;default:console.log(`Unknown message type: ${t.type}`)}}),this.ws.onclose=()=>{},this.ws.onerror=e=>{console.error("WebSocket error observed:",e),this.ws.close()}}sendStartCall(e){this.ws.send(JSON.stringify({type:"start_call",roomId:e}))}setLocalStream(e){return ve(this,null,function*(){try{this.localStream=yield navigator.mediaDevices.getUserMedia(e);let t=document.createElement("div"),n=document.createElement("video");t.className="relative flex justify-center items-center w-auto h-auto overflow-hidden rounded-xl",n.className="w-full h-full object-cover relative z-1",n.autoplay=!0,n.muted=!0,n.srcObject=this.localStream,n.playsInline=!0,t.appendChild(n),this.videoContainer.nativeElement.appendChild(t),this.cdr.detectChanges();let s=new AudioContext,o=s.createAnalyser();s.createMediaStreamSource(this.localStream).connect(o);let r=o.frequencyBinCount,f=new Uint8Array(r),C=10,h=()=>{o.getByteFrequencyData(f);let g=0;for(let p=0;p<r;p++)g+=f[p];g/r>C?t.style.border="3px solid #0a1128":t.style.border="none",requestAnimationFrame(h)};h()}catch(t){console.error("Could not get user media",t)}})}ngOnDestroy(){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"close_call",roomId:this.roomId}))}changeMediaQuality(e){console.log(e.target.value)}setRemoteStream(e,t){this.listUUIDS.find(o=>o.uuid===t.from)||this.listUUIDS.push({uuid:t.from,video:null,audio:null});let s=this.listUUIDS.findIndex(o=>o.uuid===t.from);if(e.track.kind==="video"&&(this.listUUIDS[s].video=e),e.track.kind==="audio"&&(this.listUUIDS[s].audio=e),(!this.listUUIDS[s].video||!this.listUUIDS[s].audio)&&t.from){this.remoteStream=e.streams[0],this.audioContext||(this.audioContext=new AudioContext);let o=document.createElement("div"),l=document.createElement("video");l.autoplay=!0,l.playsInline=!0,l.muted=!1,l.srcObject=this.remoteStream,l.id=t.from,o.id=t.from,o.className="relative flex justify-center items-center w-auto h-auto overflow-hidden rounded-xl",l.className="w-full h-full object-cover",o.appendChild(l);let r=!1;this.remoteVideos.forEach(u=>{u.id===t.from&&(u.videoContainer.getElementsByTagName("video")[0].srcObject=this.remoteStream,r=!0)}),r||(this.videoContainer.nativeElement.appendChild(o),this.remoteVideos.push({id:t.from,videoContainer:o}));let f=this.audioContext.createAnalyser();this.audioContext.createMediaStreamSource(this.remoteStream).connect(f);let h=f.frequencyBinCount,g=new Uint8Array(h),y=10,p=()=>{f.getByteFrequencyData(g);let u=0;for(let D=0;D<h;D++)u+=g[D];u/h>y?o.style.border="3px solid #0a1128":o.style.border="none",requestAnimationFrame(p)};p()}this.cdr.detectChanges()}removeVideoById(e){let t=this.remoteVideos.findIndex(n=>n.id===e);if(t>=0){let n=this.remoteVideos[t];this.listUUIDS=this.listUUIDS.filter(s=>s.uuid!==e),n.videoContainer.remove(),this.remoteVideos.splice(t,1),this.cdr.detectChanges()}}createPeerConnection(e){this.rtcPeerConnection=new RTCPeerConnection(this.iceServers),this.addLocalTracks(),this.rtcPeerConnection.ontrack=t=>this.setRemoteStream(t,e),this.rtcPeerConnection.onicecandidate=this.sendIceCandidate.bind(this)}addLocalTracks(){this.localStream&&this.localStream.getTracks().forEach(e=>{this.rtcPeerConnection.addTrack(e,this.localStream)})}createOffer(){return ve(this,null,function*(){try{let e=yield this.rtcPeerConnection.createOffer();yield this.rtcPeerConnection.setLocalDescription(e),this.ws.send(JSON.stringify({type:"webrtc_offer",sdp:e,roomId:this.roomId}))}catch(e){console.error("Error creating offer",e)}})}createAnswer(){return ve(this,null,function*(){try{let e=yield this.rtcPeerConnection.createAnswer();yield this.rtcPeerConnection.setLocalDescription(e),this.ws.send(JSON.stringify({type:"webrtc_answer",sdp:e,roomId:this.roomId}))}catch(e){console.error("Error creating answer",e)}})}sendIceCandidate(e){e.candidate&&this.ws.send(JSON.stringify({type:"webrtc_ice_candidate",roomId:this.roomId,label:e.candidate.sdpMLineIndex,candidate:e.candidate.candidate}))}showVideoConference(){this.showRoomSelection=!1}hiddenVideoConference(){this.showRoomSelection=!0}startRecording(){console.log("iniciando grabaci\xF3n"),this.recording?this.stopRecording():navigator.mediaDevices.getDisplayMedia({video:!0,audio:{echoCancellation:!0,noiseSuppression:!0}}).then(e=>{console.log("stream recibido"),this.stream=e,this.recorder=new Ye.default(e,{type:"video",mimeType:"video/mp4",recorderType:Ye.default.MediaStreamRecorder}),this.recorder.startRecording(),this.recording=!0}).catch(e=>{console.error("Error al iniciar la grabaci\xF3n:",e)})}stopRecording(){this.recorder&&this.stream&&this.recorder.stopRecording(()=>{let e=this.recorder.getBlob(),t=URL.createObjectURL(e),n=document.createElement("a"),o=new Date().toISOString().slice(0,19).replace("T"," ").replace(/:/g,"-");n.href=t,n.download=`grabacion-${o}.mp4`,n.click(),this.stream.getTracks().forEach(l=>l.stop()),this.recording=!1})}static \u0275fac=function(t){return new(t||i)(ye(He),ye(st),ye(lt))};static \u0275cmp=rt({type:i,selectors:[["app-home"]],viewQuery:function(t,n){if(t&1&&(Me(Pt,5),Me(Ut,5),Me(Bt,5)),t&2){let s;Ve(s=xe())&&(n.audioProgress=s.first),Ve(s=xe())&&(n.videoContainer=s.first),Ve(s=xe())&&(n.transcriptsContainer=s.first)}},decls:13,vars:8,consts:[["transcriptsContainer",""],["videoContainer",""],[2,"width","100vw","height","100vh","position","absolute","background","#ffffffa8","z-index","99","display","flex","align-items","center",3,"ngStyle"],[2,"background","white","padding","1rem 1rem","width","100%","max-width","70vw","height","58%","border-radius","2rem","box-shadow","1px 0px 20px 0px #8f8f8f","border","14px solid #efefef","position","relative"],[1,"btn-close-modal",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","none","viewBox","0 0 24 24",1,"w-6","h-6"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M6 18 17.94 6M18 18 6.06 6"],[1,"transcripts",2,"overflow-y","auto","overflow-x","hidden","height","100%"],[4,"ngFor","ngForOf"],[2,"display","flex","flex-direction","column","width","100%","justify-content","center","align-items","center","height","50vh","z-index","99","overflow-y","scroll","margin-top","4rem","margin-bottom","4rem","background","white","padding","0rem","border-radius","100%","box-shadow","1px 1px 0 50px white"],["style","display: flex; flex-direction: column; gap: 0px",4,"ngIf"],["class","flex flex-col",4,"ngIf"],["style",`
      height: auto;
      max-height: 50vh;
    `,"class","w-9/12",4,"ngIf"],["style",`position: absolute;
  bottom: -3rem;
  left: 0px;
  right: 0px;display: flex; justify-content: center;`,4,"ngIf"],[2,"font-weight","700","font-size","1rem","font-family","system-ui","color","#393939"],[2,"display","flex","flex-direction","column","gap","0px"],[2,"color","#0a1128","text-align","center","margin-bottom","0px","font-weight","700","font-size","2rem"],[2,"color","#0a1128","text-align","center","margin-top","0px","font-weight","normal","font-size","1rem","margin-bottom","1rem"],[1,"flex","flex-col"],[1,"lg:col-span-2","col-span-8","flex","flex-col","justify-end","items-end","lg:flex","lg:justify-end","lg:items-start",2,"height","100%","width","100%","padding","1rem","position","relative"],[2,"padding","1rem","border-radius","1rem","height","fit-content","width","100%"],[1,"grid","grid-cols-4","col-span-8","gap-2"],[1,"col-span-4","cursor-pointer","grid","grid-cols-4",2,"justify-content","center","align-items","center","display","flex","background-color","#00d9c0","width","100%",3,"click","ngClass"],["class","col-span-3 w-full text-white","style","font-weight: 600",4,"ngIf"],["style","background-color: #00d9c0","class","w-8 h-8 text-white rounded-sm p-1 cursor-pointer","aria-hidden","true","xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","none","viewBox","0 0 24 24",4,"ngIf"],[1,"col-span-3","w-full","text-white",2,"font-weight","600"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","none","viewBox","0 0 24 24",1,"w-8","h-8","text-white","rounded-sm","p-1","cursor-pointer",2,"background-color","#00d9c0"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13.213 9.787a3.391 3.391 0 0 0-4.795 0l-3.425 3.426a3.39 3.39 0 0 0 4.795 4.794l.321-.304m-.321-4.49a3.39 3.39 0 0 0 4.795 0l3.424-3.426a3.39 3.39 0 0 0-4.794-4.795l-1.028.961"],[1,"w-9/12",2,"height","auto","max-height","50vh"],[1,"grid","gap-4","grid-cols-2","w-full","h-full","p-4"],[2,"position","absolute","bottom","-3rem","left","0px","right","0px","display","flex","justify-content","center"],[2,"background-color","#171720","border-radius","1rem","padding","1rem","margin","1rem 0rem","right","0px","box-shadow","1px 1px 20px 2px #171720","display","flex","justify-content","center","width","auto","bottom","1rem"],[1,"button-class",3,"click"],[2,"cursor","pointer"],["class","w-6 h-6 text-gray-800 text-white","aria-hidden","true","xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","currentColor","viewBox","0 0 24 24",4,"ngIf"],["class","w-6 h-6 text-gray-800 dark:text-white","aria-hidden","true","xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","none","viewBox","0 0 24 24",4,"ngIf"],["class","w-6 h-6 text-gray-800 text-white","xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","currentColor","viewBox","0 0 24 24",4,"ngIf"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-gray-800","text-white"],["fill-rule","evenodd","d","M14 7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7Zm2 9.387 4.684 1.562A1 1 0 0 0 22 17V7a1 1 0 0 0-1.316-.949L16 7.613v8.774Z","clip-rule","evenodd"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","none","viewBox","0 0 24 24",1,"w-6","h-6","text-gray-800","dark:text-white"],["stroke","currentColor","stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M14 6H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1Zm7 11-6-2V9l6-2v10Z"],["fill-rule","evenodd","d","M5 8a1 1 0 0 1 1 1v3a4.006 4.006 0 0 0 4 4h4a4.006 4.006 0 0 0 4-4V9a1 1 0 1 1 2 0v3.001A6.006 6.006 0 0 1 14.001 18H13v2h2a1 1 0 1 1 0 2H9a1 1 0 1 1 0-2h2v-2H9.999A6.006 6.006 0 0 1 4 12.001V9a1 1 0 0 1 1-1Z","clip-rule","evenodd"],["d","M7 6a4 4 0 0 1 4-4h2a4 4 0 0 1 4 4v5a4 4 0 0 1-4 4h-2a4 4 0 0 1-4-4V6Z"],["d","m15.506 14.097.994.995A3.989 3.989 0 0 0 17.975 12V9.011a.996.996 0 0 1 1.992 0v2.99a5.981 5.981 0 0 1-2.054 4.503l1.762 1.762a.996.996 0 1 1-1.408 1.408L4.325 5.733a.996.996 0 0 1 1.408-1.408L7.04 5.632a3.984 3.984 0 0 1 3.964-3.59h1.992c2.2 0 3.983 1.783 3.983 3.983v4.98a3.975 3.975 0 0 1-1.473 3.092ZM4.033 10.008a.996.996 0 1 1 1.992 0V12a3.99 3.99 0 0 0 3.984 3.984H12c.55 0 .996.446.996.996v2.988h1.992a.996.996 0 0 1 0 1.992H9.012a.996.996 0 0 1 0-1.992h1.992v-1.992h-.997a5.981 5.981 0 0 1-5.974-5.974v-1.993Z"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","fill","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-gray-800","text-white"],["d","M13 6.037c0-1.724-1.978-2.665-3.28-1.562L5.638 7.933H4c-1.105 0-2 .91-2 2.034v4.066c0 1.123.895 2.034 2 2.034h1.638l4.082 3.458c1.302 1.104 3.28.162 3.28-1.562V6.037Z"],["fill-rule","evenodd","d","M14.786 7.658a.988.988 0 0 1 1.414-.014A6.135 6.135 0 0 1 18 12c0 1.662-.655 3.17-1.715 4.27a.989.989 0 0 1-1.414.014 1.029 1.029 0 0 1-.014-1.437A4.085 4.085 0 0 0 16 12a4.085 4.085 0 0 0-1.2-2.904 1.029 1.029 0 0 1-.014-1.438Z","clip-rule","evenodd"],["fill-rule","evenodd","d","M17.657 4.811a.988.988 0 0 1 1.414 0A10.224 10.224 0 0 1 22 12c0 2.807-1.12 5.35-2.929 7.189a.988.988 0 0 1-1.414 0 1.029 1.029 0 0 1 0-1.438A8.173 8.173 0 0 0 20 12a8.173 8.173 0 0 0-2.343-5.751 1.029 1.029 0 0 1 0-1.438Z","clip-rule","evenodd"],["d","M5.707 4.293a1 1 0 0 0-1.414 1.414l14 14a1 1 0 0 0 1.414-1.414l-.004-.005C21.57 16.498 22 13.938 22 12a9.972 9.972 0 0 0-2.929-7.071 1 1 0 1 0-1.414 1.414A7.972 7.972 0 0 1 20 12c0 1.752-.403 3.636-1.712 4.873l-1.433-1.433C17.616 14.37 18 13.107 18 12c0-1.678-.69-3.197-1.8-4.285a1 1 0 1 0-1.4 1.428A3.985 3.985 0 0 1 16 12c0 .606-.195 1.335-.59 1.996L13 11.586V6.135c0-1.696-1.978-2.622-3.28-1.536L7.698 6.284l-1.99-1.991ZM4 8h.586L13 16.414v1.451c0 1.696-1.978 2.622-3.28 1.536L5.638 16H4a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2Z"]],template:function(t,n){if(t&1){let s=Re();V(0,"div",2)(1,"div",3)(2,"div",4),de("click",function(){return fe(s),pe(n.openModelTranscript=!1)}),K(),V(3,"svg",5),$(4,"path",6),x()(),ot(),V(5,"div",7,0),te(7,Gt,5,2,"div",8),x()()(),V(8,"div",9),te(9,Ht,5,0,"div",10)(10,qt,8,6,"div",11)(11,$t,3,0,"div",12)(12,ei,13,6,"div",13),x()}t&2&&(P("ngStyle",at(6,Nt,n.openModelTranscript?"flex":"none")),O(7),P("ngForOf",n.transcriptTexts),O(2),P("ngIf",!n.connection),O(),P("ngIf",!n.connection),O(),P("ngIf",n.connection),O(),P("ngIf",n.connection))},dependencies:[ut,ct,ht,ft],styles:[".button-class[_ngcontent-%COMP%]{padding:1rem;border-radius:1rem;cursor:pointer}.button-class[_ngcontent-%COMP%]:hover{background-color:#242331}.client-container[_ngcontent-%COMP%]{box-shadow:5px 6px #4e4468;border:1px solid #5b507a;transition:.5s all;background:#5b507a}.client-container[_ngcontent-%COMP%]:hover{box-shadow:none;transition:.5s all;transform:translate(5px,6px);background:#4e4468;cursor:pointer}.bg-connection[_ngcontent-%COMP%]{background:#00d9c0}.btn-connection[_ngcontent-%COMP%]{transition:.3s all;box-shadow:1px 4px 0 1px #006b5e}.btn-connection[_ngcontent-%COMP%]:hover{box-shadow:none;transition:.3s all;transform:translate(1px,4px)}.bg-close[_ngcontent-%COMP%]{background:#c5283d;color:#fff}.scrollContainer[_ngcontent-%COMP%]{overflow-y:scroll;scrollbar-width:none;-ms-overflow-style:none}.scrollContainer[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0}video[_ngcontent-%COMP%]{border:none}.video-container[_ngcontent-%COMP%]{position:relative;width:100%;padding-top:100%;overflow:hidden}.video-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;border-radius:50%;box-shadow:1px 1px 8px 1px #484848}.progress-container[_ngcontent-%COMP%]{width:20%;height:10px;border-radius:10px;margin-top:1rem}.progress-bar[_ngcontent-%COMP%]{height:100%;width:0%;background:#4caf50;border-radius:10px}.btn-text[_ngcontent-%COMP%]{position:absolute;bottom:0;right:0;margin:1rem;padding:1rem;background:#fff;border-radius:1rem;transition:.5s all;box-shadow:5px 5px #000;cursor:pointer}.btn-text[_ngcontent-%COMP%]:hover{box-shadow:none;transition:.5s all;transform:translate(5px,6px);background:#e9e9e9;cursor:pointer}.btn-close-modal[_ngcontent-%COMP%]{position:absolute;top:0;right:0;background:red;padding:1rem;border-radius:1rem;font-size:2rem;display:flex;justify-content:center;align-items:center;transition:.5s all;color:#fff;box-shadow:3px 4px 0 3px #b40000;margin-top:-2rem;margin-right:-2rem;cursor:pointer}.btn-close-modal[_ngcontent-%COMP%]:hover{box-shadow:none;transition:.5s all;transform:translate(5px,6px);background:#e9e9e9;cursor:pointer}.reveal-up[_ngcontent-%COMP%]{opacity:1;transform:translateY(-20px);transition:opacity .5s ease-out,transform .5s ease-out}.reveal-up.show[_ngcontent-%COMP%]{width:0px}.transcripts[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.transcripts[_ngcontent-%COMP%]{-ms-overflow-style:none;scrollbar-width:none}"]})};var ti=[{path:"",component:Oe}],Le=class i{static \u0275fac=function(t){return new(t||i)};static \u0275mod=ae({type:i});static \u0275inj=se({imports:[We.forChild(ti),We]})};var ii={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},$i=it(tt({},ii),{"[class.ng-submitted]":"isSubmitted"});var ni=new nt("CallSetDisabledState",{providedIn:"root",factory:()=>_t}),_t="always";var ri=(()=>{let e=class e{};e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=ae({type:e}),e.\u0275inj=se({});let i=e;return i})();var Dt=(()=>{let e=class e{static withConfig(n){return{ngModule:e,providers:[{provide:ni,useValue:n.callSetDisabledState??_t}]}}};e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=ae({type:e}),e.\u0275inj=se({imports:[ri]});let i=e;return i})();var St=class i{static \u0275fac=function(t){return new(t||i)};static \u0275mod=ae({type:i});static \u0275inj=se({imports:[Dt,pt,Le]})};export{St as HomeModule};
